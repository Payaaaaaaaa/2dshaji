# 2D 非对称联机像素游戏

这是一个基于 Godot 4.4 的 2D 非对称对抗联机游戏项目，灵感来源于《黎明杀机》。

## 项目概述

本游戏是一款 1 vs 多 的非对称联机游戏，一名玩家扮演杀手，其他玩家扮演幸存者。幸存者需要修理发电机并逃离地图，而杀手则需要阻止他们，将他们全部击倒并挂上钩子。

## 游戏特点

- **非对称gameplay**: 杀手和幸存者拥有不同的视角、能力和目标
- **合作与对抗**: 幸存者需要团队协作，而杀手需要采取策略分割包围
- **程序化地图**: 每局游戏的地图布局、物品位置都会有所不同
- **多平台支持**: 支持PC、Web以及计划中的移动设备
- **像素美术风格**: 复古风格与现代gameplay的结合

## 网络框架实现

项目使用 Godot 4 的高级 MultiplayerAPI 实现服务器-客户端架构的联机功能：

- **NetworkManager** - 管理网络连接、会话和玩家信息，包括创建/加入房间、玩家列表同步、准备状态等。
- **MultiplayerManager** - 处理游戏场景中的对象同步，包括角色生成、物件创建和状态同步。
- **服务器权威模型** - 所有重要游戏状态由服务器验证，防止作弊。
- **心跳机制** - 检测客户端状态，处理玩家断线情况。
- **RPC系统** - 使用Godot 4的@rpc注解和可靠/不可靠模式区分不同类型的网络消息。<!--  -->

## 角色控制系统

角色使用服务器权威的状态同步机制：

- **Character基类** - 处理基础移动、动画和交互，使用MultiplayerSynchronizer同步位置和状态。
- **Survivor类** - 实现幸存者特有行为，如修理发电机、救援队友、被扛起和挂钩等。
- **Killer类** - 实现杀手特有行为，如攻击、追击和携带幸存者等。
- **平滑插值** - 远程角色移动使用位置缓冲和插值，确保流畅的游戏体验。
- **状态机系统** - 管理角色在不同状态下的行为和动画。

### 状态同步细节

- 位置同步采用混合客户端预测+服务器校正模式，减少网络延迟影响
- 重要状态（健康、交互等）使用可靠RPC，次要状态（位置）使用不可靠RPC
- 使用MultiplayerSynchronizer自动同步属性，简化同步代码
- 远程玩家使用插值平滑移动，避免卡顿和抖动

## 游戏逻辑

- 服务器控制游戏流程，从开始到结束
- 发电机修理、出口门打开和胜利条件判定
- 玩家状态同步，包括健康/受伤/倒地/死亡等
- 事件系统，通知重要游戏事件（修好发电机、逃脱、死亡等）
- 断线重连支持，处理玩家中途离开的情况

## 技术架构

游戏使用以下技术和架构:

- **Godot 4.4引擎** - 使用GDScript编写，充分利用引擎高级功能
- **高层MultiplayerAPI** - 使用Godot 4的MultiplayerSpawner和MultiplayerSynchronizer
- **模块化设计** - 将游戏逻辑分为Global、Network、Character、Interaction等模块
- **状态机** - 使用枚举状态和状态处理函数实现简洁的状态机
- **事件系统** - 使用信号（Signal）机制实现松耦合的事件通知

## 已完成功能

- [x] 网络连接和会话管理
- [x] 角色基类和控制系统
- [x] 服务器权威同步模型
- [x] 游戏场景初始化
- [x] 玩家列表和准备系统
- [x] 角色状态机
- [x] 断线处理机制
- [x] 心跳检测和超时处理
- [x] 位置插值平滑移动
- [x] 交互物件框架和同步机制
- [x] 发电机、钩子、出口门基础交互物件
- [x] 板子、宝箱、锁定栅栏等特殊交互物件
- [x] 技能检测(QTE)系统框架
- [x] 完整UI系统
  - [x] 主菜单界面
  - [x] 游戏大厅界面
  - [x] 游戏HUD界面
  - [x] 交互提示UI
  - [x] 技能检测UI
  - [x] 物品/背包系统

## 待实现功能

- [x] 程序化地图生成
- [x] 声音系统
- [x] 移动设备触控支持
- [x] UI系统与游戏逻辑完全整合
- [x] 游戏平衡性调整

## 开发指南

### 代码规范

- 使用 PascalCase 命名类名和节点名
- 使用 snake_case 命名变量和函数
- 在功能复杂的方法上添加注释
- 使用 @export 标记需要在编辑器中调整的属性
- 使用 @rpc 注解标记网络方法，并明确指定模式

### 网络同步约定

- 服务器负责所有游戏状态的最终判定
- 客户端仅发送输入和交互请求
- 状态变更通过服务器验证后广播给所有客户端
- 使用"可靠"传输重要状态，"不可靠"传输实时位置

### 运行项目

1. 克隆或下载本仓库
2. 使用 Godot 4.4 或更新版本打开项目
3. 按 F5 运行项目

### 测试联机

1. 在一个实例中创建服务器（主机）
2. 在另一个实例中通过IP连接到服务器
3. 两个客户端分别扮演杀手和幸存者

## 文件结构

```
/scenes         - 场景文件夹
  /characters   - 角色场景
  /objects      - 交互物件场景
  /ui           - 用户界面场景
/scripts        - 脚本文件夹
  Character.gd  - 角色基类
  Survivor.gd   - 幸存者实现
  Killer.gd     - 杀手实现
  Global.gd     - 全局单例
  NetworkManager.gd - 网络管理
  MultiplayerManager.gd - 多人游戏管理
  GameLogic.gd  - 游戏逻辑
  // 其他脚本...
/assets         - 资源文件夹
  /sprites      - 图形资源
  /audio        - 音频资源
  /fonts        - 字体资源
```

## 开发说明

本项目基于 Godot 4.4 使用 GDScript 开发，以保证良好的跨平台性。请确保使用兼容版本的 Godot 引擎打开项目。

## 如何开始游戏

1. 启动游戏
2. 在主菜单选择"创建房间"(作为杀手)或"加入房间"(作为幸存者)
3. 在大厅等待所有玩家准备就绪
4. 杀手玩家点击"开始游戏"开始游戏

## 开发计划

- 添加更多地图
- 增加更多的杀手和幸存者角色
- 实现道具和技能系统
- 添加音效和背景音乐
- 优化视觉效果和UI

## 致谢

- Godot引擎社区
- 所有游戏测试者和反馈提供者 